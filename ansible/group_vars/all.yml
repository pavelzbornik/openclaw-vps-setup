---
# Global variables for all hosts

# System Configuration
timezone: "UTC"
locale: "en_US.UTF-8"

# ─── Upstream-aligned variables ──────────────────────────────────────
# These match upstream openclaw-ansible defaults/main.yml.
# Only override when your deployment needs differ from upstream defaults.

openclaw_user: openclaw
openclaw_home: "/home/{{ openclaw_user }}"
openclaw_config_dir: "{{ openclaw_home }}/.openclaw"
openclaw_port: 3000

# LAN ingress (Nginx)
openclaw_lan_enabled: true
openclaw_lan_subnet: "192.168.1.0/24"
openclaw_nginx_server_name: "openclaw.lan"
openclaw_nginx_ssl_dir: "/etc/nginx/ssl"
openclaw_nginx_ssl_cert: "{{ openclaw_nginx_ssl_dir }}/openclaw.crt"
openclaw_nginx_ssl_key: "{{ openclaw_nginx_ssl_dir }}/openclaw.key"
openclaw_nginx_ssl_subject: "/CN={{ openclaw_nginx_server_name }}"
openclaw_nginx_ssl_san: "DNS:{{ openclaw_nginx_server_name }}"
openclaw_nginx_rate_limit: "10r/s"
openclaw_nginx_rate_burst: 20

# Node.js version (upstream default: 22.x)
nodejs_version: "22.x"

# Installation mode: 'release' (pnpm install -g) or 'development' (git clone)
openclaw_install_mode: "release"

# SSH keys for the openclaw user (upstream variable)
# openclaw_ssh_keys:
#   - "ssh-ed25519 AAAA... user@host"
openclaw_ssh_keys: []

# Tailscale (upstream variable — set to true to install)
tailscale_enabled: true
# Pass via -e tailscale_authkey=... (workflow fetches from 1Password at runtime)
tailscale_authkey: ""

# CI test mode — skips systemd/Docker tasks (upstream variable)
ci_test: false

# ─── Local extensions (not in upstream) ──────────────────────────────

# SSH hardening — disables password auth and root login via sshd_config.
# Set to false only if you need password-based SSH access.
ssh_harden: true

# Extra packages not covered by upstream system-tools
extra_packages:
  - acl
  - rsync
  - python3-cryptography

# OpenClaw onboarding behavior
openclaw_config_onboard_install_daemon: false
openclaw_run_doctor: false

# 1Password Configuration
onepassword_cli_version: "latest"
onepassword_cli_deb_url: "https://downloads.1password.com/linux/debian/amd64/stable/1password-cli-amd64-latest.deb"

# Discord allowlist/guilds — override in vault.yml with actual IDs
openclaw_discord_allowlist: "{{ vault_openclaw_discord_allowlist | default([]) }}"
openclaw_discord_guilds: "{{ vault_openclaw_discord_guilds | default([]) }}"

# OpenClaw Configuration Template Variables (for unattended deploys)
openclaw_config:
  auth:
    profiles:
      "openrouter:default":
        provider: openrouter
        mode: api_key
  agents:
    defaults:
      workspace: "{{ openclaw_config_dir }}/workspace"
      model:
        primary: "openrouter/anthropic/claude-sonnet-4.6"
      models:
        "openrouter/auto":
          alias: "OpenRouter"
        "openrouter/anthropic/claude-sonnet-4": {}
        "openrouter/anthropic/claude-sonnet-4-6": {}
  commands:
    native: "auto"
    nativeSkills: "auto"
    restart: true
  gateway:
    mode: "local"
    # Keep gateway loopback-only; LAN access goes through Nginx reverse proxy.
    bind: "loopback"
    port: "{{ openclaw_port }}"
    trustedProxies:
      - "127.0.0.1"
    mdns:
      enabled: false
    tailscale:
      mode: "off"
      resetOnExit: false
    auth:
      mode: "token"
      token: "${OPENCLAW_GATEWAY_TOKEN}"
  channels:
    telegram:
      enabled: true
      dmPolicy: "pairing"
      groupPolicy: "allowlist"
      streamMode: "partial"
    discord:
      enabled: false
      groupPolicy: "allowlist"
      dmPolicy: "allowlist"

# Environment Variables for OpenClaw Service
openclaw_env_vars:
  NODE_ENV: "production"

# 1Password service account token (reused by backup.yml and openclaw_config role)
# Set OP_SERVICE_ACCOUNT_TOKEN in your shell — the deploy script passes it via -e.
# Vault fallback: vault_openclaw_op_service_account_token in group_vars/vault.yml (legacy).
_op_token_env: "{{ lookup('env', 'OP_SERVICE_ACCOUNT_TOKEN') }}"  # pragma: allowlist secret
_op_token_vault: "{{ vault_openclaw_op_service_account_token | default('') }}"  # pragma: allowlist secret
openclaw_op_service_account_token: "{{ _op_token_env | default(_op_token_vault, true) }}"  # pragma: allowlist secret
openclaw_op_service_account_token_vault: "OpenClaw"  # pragma: allowlist secret
openclaw_op_service_account_token_item: "Service Account Auth Token"  # pragma: allowlist secret
openclaw_op_service_account_token_field: "credential"  # pragma: allowlist secret

# 1Password-backed OpenRouter API key settings
openclaw_openrouter_api_key_vault: "OpenClaw"  # pragma: allowlist secret
openclaw_openrouter_api_key_item: "OpenRouter API Credentials"  # pragma: allowlist secret
openclaw_openrouter_api_key_field: "credential"  # pragma: allowlist secret

# 1Password-backed Telegram bot token settings
openclaw_telegram_bot_token_vault: "OpenClaw"
openclaw_telegram_bot_token_item: "Telegram Bot"  # pragma: allowlist secret
openclaw_telegram_bot_token_field: "credential"

# 1Password-backed Tailscale auth key settings
openclaw_tailscale_authkey_vault: "OpenClaw"  # pragma: allowlist secret
openclaw_tailscale_authkey_item: "Tailscale"  # pragma: allowlist secret
openclaw_tailscale_authkey_field: "credential"  # pragma: allowlist secret

# 1Password-backed Discord bot token settings
openclaw_discord_bot_token_vault: "OpenClaw"
openclaw_discord_bot_token_item: "discord"
openclaw_discord_bot_token_field: "credential"

# 1Password-backed OpenAI API key settings
openclaw_openai_api_key_vault: "OpenClaw"  # pragma: allowlist secret
openclaw_openai_api_key_item: "OpenAI"  # pragma: allowlist secret
openclaw_openai_api_key_field: "credential"  # pragma: allowlist secret

# 1Password-backed OpenClaw gateway token settings
openclaw_gateway_token_vault: "OpenClaw"
openclaw_gateway_token_item: "OpenClaw Gateway"
openclaw_gateway_token_field: "credential"

# 1Password-backed OpenClaw identity/user content
openclaw_content_vault: "OpenClaw"
openclaw_content_item: "OpenClaw"
openclaw_content_identity_md_field: "identity_md"
openclaw_content_user_md_field: "user_md"
openclaw_content_vscode_ssh_key_field: "vscode_ssh_key"

# 1Password-backed Discord config (allowlist, guilds — lives in the discord bot token item)
openclaw_discord_config_vault: "OpenClaw"
openclaw_discord_config_item: "discord"
openclaw_discord_config_allowlist_field: "allowlist"
openclaw_discord_config_guilds_field: "guilds"

# ─── Samba file share ────────────────────────────────────────────────────────

openclaw_samba_enabled: true
openclaw_samba_share_name: uploads
openclaw_samba_share_path: "{{ openclaw_home }}/uploads"

# 1Password-backed Samba password settings
openclaw_samba_password_vault: "OpenClaw"  # pragma: allowlist secret
openclaw_samba_password_item: "Samba"  # pragma: allowlist secret
openclaw_samba_password_field: "credential"  # pragma: allowlist secret

# ─── Backup / Restore (S3 + 1Password) ───────────────────────────────────────

# Backup: cron → encrypt → S3 upload
openclaw_backup_dir: "/var/lib/openclaw/backups"
openclaw_backup_script: "/usr/local/bin/openclaw-backup.sh"
openclaw_backup_env_file: "/etc/openclaw/backup.env"
openclaw_backup_cron_hour: "2"
openclaw_backup_cron_minute: "0"
openclaw_s3_bucket: ""          # required — set in vault or inventory
openclaw_s3_prefix: "openclaw"
openclaw_s3_region: "us-east-1"

# 1Password refs for backup encryption passphrase
openclaw_backup_passphrase_vault: "OpenClaw"
openclaw_backup_passphrase_item: "AWS Backup"
openclaw_backup_passphrase_field: "passphrase"

# 1Password refs for AWS credentials
openclaw_aws_key_vault: "OpenClaw"
openclaw_aws_key_item: "AWS Backup"
openclaw_aws_access_key_field: "access_key_id"
openclaw_aws_secret_key_field: "secret_access_key"  # pragma: allowlist secret
openclaw_aws_s3_bucket_field: "s3_bucket"

# For restore: pass on CLI with -e openclaw_restore_s3_path=s3://bucket/prefix/file.tgz.enc
openclaw_restore_s3_path: ""
